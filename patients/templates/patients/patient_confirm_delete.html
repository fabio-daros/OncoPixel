{% load i18n %}
<div id="confirmDeleteModal" class="hidden fixed inset-0 z-50 items-center justify-center">
  <!-- overlay -->
  <div class="absolute inset-0 bg-black/60" data-modal-close></div>

  <!-- content -->
  <div class="relative mx-4 w-full max-w-md rounded-2xl border border-gray-800 bg-gray-950 p-6 shadow-xl">
    <div class="flex items-center gap-2 text-amber-300">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v4m0 4h.01M4.93 4.93l14.14 14.14M12 2a10 10 0 100 20 10 10 0 000-20z"/>
      </svg>
      <h3 class="text-xl font-semibold">{% trans "Confirm Delete" %}</h3>
    </div>

    <p class="mt-3 text-gray-300">
      {% trans "Are you sure you want to delete patient:" %}
      <span id="confirmDeletePatientName" class="font-medium text-white"></span>
      <span id="confirmDeletePatientSurname" class="font-medium text-white"></span>?
    </p>

    <form id="confirmDeleteForm" method="post" class="mt-6 flex justify-end gap-2">
      {% csrf_token %}
      <button type="button"
              class="rounded-2xl border border-gray-700 bg-gray-900 px-4 py-2 text-gray-200 hover:bg-gray-800"
              data-modal-close>{% trans "Cancel" %}</button>
      <button type="submit"
              class="rounded-2xl bg-red-600 px-5 py-2 font-medium text-white hover:bg-red-500">
        {% trans "Delete" %}
      </button>
    </form>

    <!-- template de URL para action do form: troca /0/ por /<pk>/ -->
    <span id="patient-delete-url-template"
          data-template="{% url 'patients:delete' 0 %}"
          class="hidden"></span>
  </div>
</div>

<script>
(function () {
  const modal = document.getElementById('confirmDeleteModal');
  const form  = document.getElementById('confirmDeleteForm');
  const tplEl = document.getElementById('patient-delete-url-template');

  function open()  { modal.classList.remove('hidden'); modal.classList.add('flex'); }
  function close() { modal.classList.add('hidden');   modal.classList.remove('flex'); }

  function setAction(pk) {
    const tpl = (tplEl && tplEl.dataset && tplEl.dataset.template) || '/patients/0/delete/';
    form.action = tpl.replace('/0/', `/${pk}/`);
  }

  // API global opcional, caso queira abrir via JS manualmente
  window.openDeleteModal = function(pk, name, surname) {
    document.getElementById('confirmDeletePatientName').textContent = name || '';
    document.getElementById('confirmDeletePatientSurname').textContent = surname || '';
    setAction(pk);
    open();
  };

  // Abrir via delegação: qualquer .open-delete com data-id / data-name / data-surname
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.open-delete');
    if (!btn) return;
    e.preventDefault();
    const pk = btn.dataset.id || btn.dataset.pk;
    const name = btn.dataset.name || btn.getAttribute('data-name');
    const surname = btn.dataset.surname || btn.getAttribute('data-surname');
    if (!pk) return;
    window.openDeleteModal(pk, name, surname);
  });

  // Fechar por overlay/botão
  modal.addEventListener('click', (e) => {
    if (e.target.hasAttribute('data-modal-close')) close();
  });
})();
</script>
