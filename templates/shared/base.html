{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}" translate="no">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <title>{% block title %}OncoPixel{% endblock %}</title>
    <!-- favicon -->
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Estilo extra -->
    <style>
        [x-cloak] {
            display: none !important;
        }
    </style>

    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      crossorigin="anonymous" referrerpolicy="no-referrer">

</head>

<body class="min-h-screen bg-gray-900 text-gray-200 flex flex-col" x-data="{ sidebarOpen: false }">
    <main class="flex-grow px-10 py-10">
    <div class="flex justify-between items-center mb-8">
        <!-- Button Sandwich + Logo -->
        <div class="flex items-center gap-3">
        <button @click="sidebarOpen = !sidebarOpen"
                class="text-white text-3xl hover:text-green-500 transition"
                aria-label="Abrir/fechar menu">
          <i :class="sidebarOpen ? 'bi bi-x' : 'bi bi-list'"
             class="transition-transform duration-200"
             :style="sidebarOpen ? 'transform: rotate(90deg);' : ''"></i>
        </button>

        <a href="{% url 'dashboard:home' %}" class="flex items-center space-x-2 hover:opacity-90 transition">
          <img src="{% static 'images/oncopixel_logo.png' %}" class="h-10 w-auto" alt="Logo">
          <span class="text-3xl font-bold text-white">
            Onco<span class="text-green-500">Pixel</span>
          </span>
        </a>
      </div>

            <form action="{% url 'set_language' %}" method="post">
                {% csrf_token %}
                <div class="flex items-center gap-2">
                    <!-- Status OncoBrain -->
                    <div id="oncobrain-status" x-data="{ status: 'checking' }" x-init="startHeartbeatMonitor()"
                        data-heartbeat-url="{% url 'image_analysis:oncobrain_heartbeat' %}"
                        class="flex items-center space-x-2 ml-8 mr-6">
                        <i class="bi bi-cpu text-white text-2xl" title="OncoBrain Status"></i>
                        <template x-if="status === 'online'">
                            <div class="relative group inline-block">
                                <i class="bi bi-check-circle-fill text-green-500 text-xl"></i>
                            <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 hidden group-hover:block bg-gray-800 text-white text-base px-2 py-1 rounded shadow-lg z-10 whitespace-nowrap">
                                {% trans 'OncoBrain API Connected' %}
                            </div>
                        </div>
                    </template>
                    <template x-if="status === 'offline'">
                        <div class="relative group inline-block">
                            <i class="bi bi-x-circle-fill text-red-500 text-xl"></i>
                            <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 hidden group-hover:block bg-gray-800 text-white text-base px-2 py-1 rounded shadow-lg z-10 whitespace-nowrap">
                                {% trans 'OncoBrain Disconnected' %}
                            </div>
                        </div>
                    </template>
                    <template x-if="status === 'checking'">
                        <div class="relative group inline-block">
                            <i class="bi bi-arrow-repeat animate-spin text-yellow-500 text-xl"></i>
                            <div class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 hidden group-hover:block bg-gray-800 text-white text-base px-2 py-1 rounded shadow-lg z-10 whitespace-nowrap">
                                {% trans 'Checking...' %}
                            </div>
                        </div>
                    </template>
                </div>
                <!-- idioma -->
                <i class="bi bi-translate text-white text-2xl"></i>
                <label>
                    <select name="language" onchange="this.form.submit()"
                            class="bg-gray-800 text-white px-3 py-2 rounded border border-gray-600 text-sm">
                        <option value="en" {% if request.LANGUAGE_CODE == 'en' %}selected{% endif %}>
                            {% trans 'English' %}
                        </option>
                        <option value="pt-br" {% if request.LANGUAGE_CODE == 'pt-br' %}selected{% endif %}>
                            {% trans 'Portuguese' %}
                        </option>
                    </select>
                </label>
            </div>
        </form>
    </div>

    <!-- Overlay -->
    <div x-show="sidebarOpen" x-cloak
         class="fixed inset-0 bg-black/50 z-40"
         @click="sidebarOpen = false"></div>

    <!-- Sidebar -->
    {% include "shared/_sidebar.html" %}

    <div class="max-w-4xl mx-auto">
      {% block content %}{% endblock %}
    </div>
  </main>

<!-- Top back button -->
<button id="scrollToTopBtn"
        class="hidden fixed bottom-16 right-32 bg-green-600 hover:bg-green-700 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg transition cursor-pointer"
        onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
    <i class="bi bi-chevron-up text-xl"></i>
</button>
<!-- Footer -->
<footer class="bg-gray-900 text-gray-400 text-center py-4">
    <p>&copy; OncoPixel {% now "Y" %}</p>
    <p>Lummertz da Rocha Lab</p>
    <p>{% trans 'Federal University of Santa Catarina' %}</p>
</footer>
<!-- Alpine.js -->
<script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>

<!-- JS's personalized -->
<script src="{% static 'js/oncobrain_heartbeat.js' %}"></script>
<script src="{% static 'js/scroll_to_top.js' %}"></script>
<script src="{% static 'js/comments.js' %}"></script>
<script src="{% static 'js/overlay-box.js' %}"></script>
</body>
</html>

